import{d as b,t as x,u as i,o as p,c as h,a,w as N,v as oe,r as j,b as y,e as te,f as K,g as O,m as se,F as q,h as R,i as k,j as ue,k as le,l as I,n as ne,p as C,q as A,s as W,x as X,y as ie,T as re,z as J,A as T,B as S,C as ce,D as de,E as pe}from"./vendor.e09f1a32.js";const fe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const u of n)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&r(m)}).observe(document,{childList:!0,subtree:!0});function s(n){const u={};return n.integrity&&(u.integrity=n.integrity),n.referrerpolicy&&(u.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?u.credentials="include":n.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(n){if(n.ep)return;n.ep=!0;const u=s(n);fetch(n.href,u)}};fe();const me=["\u30B9\u30D4\u30FC\u30C9","\u30B9\u30BF\u30DF\u30CA","\u30D1\u30EF\u30FC","\u6839\u6027","\u8CE2\u3055","\u30E1\u30E2\u5E33","\u6226\u8853\u66F8","\u79D8\u4F1D\u66F8","\u30C8\u30EC\u30FC\u30CB\u30F3\u30B0","\u30E1\u30AC\u30DB\u30F3","\u30BF\u30FC\u30F3","\u30A6\u30A7\u30A4\u30C8","\u8E44\u9244","\u30D0\u30A4\u30BF\u30EB","\u30C9\u30EA\u30F3\u30AF","\u30B1\u30FC\u30AD","\u7D46\u30B2\u30FC\u30B8","\u3084\u308B\u6C17","\u4F53\u529B","\u306B\u306A\u308B","\u89E3\u6D88","\u30EC\u30FC\u30B9","\u30FB","\u306E","\u30FC","\u30E5","\u30C3"];function he(...e){}var G=(e=>(e.SINGLE_MODE_ITEM_SELECT="SINGLE_MODE_ITEM_SELECT",e.LOG="LOG",e))(G||{});function ge(){const e=document.getElementById("data");if(!e)throw new Error("'#data' element not found");return JSON.parse(e.innerHTML)}const F=ge(),ve=b({props:{pageData:{type:Object,required:!0}},setup(e){return(t,s)=>x(i(F))}}),_e={class:"text-left"},ye={class:"border-b border-gray-200"},xe={class:"font-bold"},be={class:"text-sm"},we=a("span",{class:"bg-gray-200 rounded-lg px-1 mr-2"},"\u52B9\u679C",-1),Ce={class:"font-bold"},Q=b({props:{value:{type:Object,required:!0},idHidden:{type:Boolean}},setup(e){return(t,s)=>(p(),h("div",_e,[a("p",ye,[a("span",xe,x(e.value.name),1),N(a("span",{class:"text-sm float-right"},x(e.value.id),513),[[oe,!e.idHidden]])]),a("p",be,[we,a("span",Ce,x(e.value.description),1)])]))}}),Ee={class:"max-w-lg m-auto space-y-2"},$e={class:"bg-gray-200 sticky top-0 space-y-2"},De={class:"text-center bg-white p-1 rounded"},Fe=a("p",null,"select matching item for this image:",-1),Ae=["src"],Be=["action"],Oe=a("span",{class:"bg-gray-200 mx-2 rounded-full px-4"},"id",-1),ke=a("button",{type:"submit",class:"bg-theme-green text-white rounded p-2 font-bold"}," \u78BA\u8A8D ",-1),Ie={class:"space-y-1"},Me={class:"w-full flex items-center"},Te={class:"inline align-top fill-current h-8",viewBox:"0 0 24 24"},Le=["d"],Ne={class:"flex gap-1 flex-wrap"},qe={class:"space-y-2"},Re=b({props:{pageData:{type:Object,required:!0}},setup(e){var d;const t=e,s=j({id:(d=t.pageData.defaultValue)!=null?d:0,q:""});function r(o){return[o.name,o.description]}function n(o,l){const f=r(o);return l.split(" ").every(_=>f.some(w=>w.includes(_)))}const u=y(()=>t.pageData.options.filter(o=>n(o,s.q)).map(o=>{const l=o.id===s.id;return{key:o.id,value:o,attrs:{class:["border border-2 cursor-pointer",l?"border-theme-green":"border-gray-200"],onClick:()=>{s.id=o.id}}}})),m=y(()=>me.map(o=>{const l=u.value.filter(f=>n(f.value,o)).length;return{key:o,value:o,matchCount:l,attrs:{class:[(()=>l===0?"bg-gray-400 text-white":l===1?"bg-theme-green text-white":"bg-white text-theme-text")()],onClick:()=>{u.value.length!==l&&(s.q=l?`${s.q} ${o}`.trim():o)}}}})),c=y(()=>{var o;return(o=t.pageData.options.find(l=>l.id===s.id))!=null?o:{id:s.id,name:"unknown",description:"unknown"}});return te(()=>{u.value.length===1&&(s.id=u.value[0].value.id)}),(o,l)=>(p(),h("div",Ee,[a("div",$e,[a("div",De,[Fe,a("img",{src:i(F).imageURL,class:"sticky m-auto"},null,8,Ae),a("form",{action:i(F).submitURL,method:"POST",class:"flex items-center justify-center gap-2 mx-2"},[a("label",null,[Oe,N(a("input",{"onUpdate:modelValue":l[0]||(l[0]=f=>i(s).id=f),type:"number",name:"id",class:"spin-button-none w-16 text-center"},null,512),[[K,i(s).id,void 0,{number:!0}]])]),O(Q,{value:i(c),class:"inline-block border border-gray-200 flex-auto rounded px-2","id-hidden":""},null,8,["value"]),ke],8,Be)]),a("div",Ie,[a("label",Me,[(p(),h("svg",Te,[a("path",{d:i(se)},null,8,Le)])),N(a("input",{"onUpdate:modelValue":l[1]||(l[1]=f=>i(s).q=f),class:"flex-auto",type:"search",placeholder:"search"},null,512),[[K,i(s).q]])]),a("ol",Ne,[(p(!0),h(q,null,R(i(m),({key:f,value:_,attrs:w})=>(p(),h("li",k({key:f,class:"cursor-pointer inline-block rounded px-1"},w),x(_),17))),128))])])]),a("ul",qe,[(p(!0),h(q,null,R(i(u),({key:f,attrs:_,value:w})=>(p(),h("li",k({key:f,class:"bg-white rounded p-2"},_),[O(Q,{value:w},null,8,["value"])],16))),128))])]))}});function ae(){const e=[],t=r=>{e.push(r)},s=()=>{var r;for(;e.length>0;)(r=e.pop())==null||r()};return ue()&&le(s),{addCleanup:t,cleanup:s}}var M=(e=>(e.TEXT="TEXT",e.IMAGE="IMAGE",e))(M||{}),D=(e=>(e.DEBUG="DEBUG",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR",e))(D||{});async function Se({stream:e,encoding:t="utf-8",onLine:s}){const r=e.getReader();let n="";const u=new TextDecoder(t);async function m(){const{value:c,done:d}=await r.read();if(d){n&&await s(n);return}const o=u.decode(c);let l=0;for(let f=0;f<o.length;f+=1)o[f]===`
`&&(await s(n+o.slice(l,f)),l=f+1,n="");n+=o.slice(l),await m()}await m()}function Ge(e,t){return(...s)=>{e.value+=1;let r=!1;try{const n=t(...s);return n instanceof Promise&&(r=!0,n.finally(()=>{e.value-=1})),n}finally{r||(e.value-=1)}}}const je=["src"],ze=b({props:{value:{type:Object,required:!0}},setup(e){return(t,s)=>(p(),h("figure",null,[a("img",{src:e.value.url},null,8,je),a("figcaption",null,x(e.value.caption),1)]))}}),Pe=b({props:{value:{type:Object,required:!0}},setup(e){return(t,s)=>(p(),h("div",null,x(e.value.msg),1))}}),Ue=b({props:{value:{type:Object,required:!0}},setup(e){return(t,s)=>(p(),h("div",null,"unsupported item: "+x(e.value),1))}}),Ve={class:"p-1 bg-white rounded border border-gray-300"},He={class:""},Ke={class:"text-sm float-right text-gray-400"},We=a("span",{class:"dot mx-1"},null,-1),Xe=a("hr",{class:"border-gray-300 my-1"},null,-1),Je=new Map([[M.IMAGE,{component:ze}],[M.TEXT,{component:Pe}]]),Qe={component:Ue},Ye=b({props:{value:{type:Object,required:!0},lineno:{type:Number,required:!0}},setup(e){const t=e,s=new Intl.DateTimeFormat(void 0,{dateStyle:"short",timeStyle:"medium",hour12:!1}),r=new Intl.DateTimeFormat(void 0,{fractionalSecondDigits:3}),n=y(()=>{const c=new Date(t.value.ts);return`${s.format(c)}.${r.format(c)}`}),u=y(()=>{var c;return(c=Je.get(t.value.t))!=null?c:Qe}),m=y(()=>{switch(t.value.lv){case D.DEBUG:return{class:"text-gray-400 bg-gray-800"};case D.INFO:return{class:"bg-gray-300"};case D.WARN:return{class:"bg-orange-500 text-orange-800"};case D.ERROR:return{class:"bg-red-500 text-red-800"};default:return he(t.value.lv),{}}});return(c,d)=>(p(),h("li",Ve,[a("div",He,[a("span",k({class:"w-24 inline-block text-center"},i(m)),x(e.value.lv),17),a("span",Ke,[a("span",null,x(i(n)),1),We,a("span",null,x(e.lineno),1)])]),Xe,(p(),I(ne(i(u).component),{value:e.value},null,8,["value"]))]))}});function Y(e,t,{deep:s}={}){const r=C(t(e));return A(e,n=>{r.value=C(t(n)).value},{deep:s}),r}function Ze(e,...t){const{addCleanup:s,cleanup:r}=ae();A(e,n=>{r(),n&&(n.addEventListener(...t),s(()=>{n.removeEventListener(...t)}))},{immediate:!0})}function et(e,{onScrollToBottom:t,onScrollToTop:s,margin:r=()=>0,marginBottom:n=r,marginTop:u=r}){Ze(e,"scroll",m=>{const c=m.target;c.scrollTop+c.clientHeight>=c.scrollHeight-n(c)?t==null||t(c):c.scrollTop<u(c)&&(s==null||s(c))})}function tt(e,t){const s=C(e.value);return A([e,t],([r,n])=>{n||(s.value=C(r).value)}),s}function st(e,t,s=r=>r){return y({get(){return t(e.value)},set(r){e.value=s(r)}})}function nt(e,t,s){return s<=t?t:Math.min(Math.max(e,t),s)}const rt={key:1},at={key:2,class:"flex flex-center h-full"},ot=a("div",{class:"text-center"},[a("h1",{class:"text-2xl"},"Log Viewer"),a("p",null,"waiting for record")],-1),ut=[ot],lt=b({props:{records:{type:Array,required:!0},size:{type:Number,default:100},paused:{type:Boolean}},setup(e){const t=e,s=W(t,"paused"),r=W(t,"records"),n=y(()=>{if(!t.paused)return{enterFromClass:"opacity-0 transform translate-x-8",enterActiveClass:"transition-all ease-in-out duration-500 relative",enterToClass:"opacity-100",leaveFromClass:"h-full max-h-fit",leaveToClass:"h-0",leaveActiveClass:"transition-all ease-in-out duration-500 overflow-hidden"}}),u=C(),m=y(()=>{var g;return(g=u.value)==null?void 0:g.$el}),c=tt(Y(()=>t.records,()=>t.records.length,{deep:!0}),s),d=st(C(0),g=>g,g=>nt(g,0,c.value-1)),o=y(()=>d.value>0),l=y(()=>d.value<c.value-t.size),f=g=>{var v;return(v=m.value)==null?void 0:v.querySelector(`li[data-index="${g}"]`)},_=g=>{if(g===0)return;const v=d.value;d.value+=g;const E=d.value;E-v<0&&J(()=>{const $=f(v),V=f(E),H=m.value;V&&$&&H&&(H.scrollTop-=V.offsetTop-$.offsetTop)})},w=X(()=>{!o.value||_(-Math.round(t.size/2))},100),z=X(()=>{!l.value||_(Math.round(t.size/2))},100);et(m,{onScrollToTop:w,onScrollToBottom:z,margin:g=>g.offsetHeight*.3});const P=Y([c,d],()=>t.records.slice(d.value,d.value+t.size).map((g,v)=>({value:g,key:d.value+v,index:d.value+v})));return te(()=>{t.paused||(d.value=Math.max(0,t.records.length-t.size))}),A([()=>t.paused,m,P],([g,v])=>{g||!v||J(()=>{v.scroll({top:v.scrollHeight,behavior:"smooth"})})},{deep:!0}),(g,v)=>(p(),I(re,k({ref_key:"el",ref:u,class:"max-h-screen overflow-y-auto overflow-x-hidden space-y-1",tag:"ol"},i(n)),{default:ie(()=>[i(o)?(p(),h("button",{key:0,type:"button",class:"w-full text-blue-500 underline",onClick:v[0]||(v[0]=E=>i(w)())}," load previous records ")):T("",!0),(p(!0),h(q,null,R(i(P),({value:E,key:U,index:$})=>(p(),I(Ye,{key:U,value:E,lineno:$+1,"data-index":$},null,8,["value","lineno","data-index"]))),128)),i(l)?(p(),h("span",rt,[a("button",{type:"button",class:"w-full text-blue-500 underline",onClick:v[1]||(v[1]=E=>i(z)())}," load next records ")])):T("",!0),i(r).length===0?(p(),h("div",at,ut)):T("",!0)]),_:1},16))}}),B=j({messages:[]}),it=b({name:"MessageList",data(){return B},render(){return S(re,{class:"fixed top-0 right-4 flex flex-col-reverse items-end",appear:!0,tag:"ol",moveClass:"transition ease-in-out duration-200",enterActiveClass:"transition ease-in-out duration-300",enterFromClass:"opacity-0 transform translate-x-full",leaveActiveClass:"transition ease-in-out duration-1000",leaveToClass:"opacity-0"},()=>this.messages.map(e=>{const t=e.render();return t.key=e.key,t}))}});let Z=0;function ee(e){const t=Z;return Z+=1,B.messages.splice(0,0,{key:t,render:e}),()=>{const s=B.messages.findIndex(r=>r.key===t);s<0||B.messages.splice(s,1)}}class ct{info(t,s=3e3+200*t.length){const r=ee(()=>S("li",{class:"p-3 rounded-sm w-64 mx-2 my-1 bg-gray-900 text-white break-all"},t));setTimeout(r,s)}error(t,s=3e3+200*t.length){const r=ee(()=>S("li",{class:"p-3 rounded-sm w-64 mx-2 my-1 bg-red-700 text-white break-all"},t));setTimeout(r,s)}}const L={message:new ct};async function dt(e){const t=new Image;return t.src=e,t.alt=e,await t.decode(),t}const pt={class:"container max-w-2xl m-auto h-screen overflow-hidden flex flex-col gap-1"},ft={class:"flex-none flex gap-1"},mt={class:"flex flex-auto items-center"},ht={class:"inline align-top fill-current h-8",viewBox:"0 0 24 24"},gt=["d"],vt=a("input",{class:"flex-auto rounded border-gray-300",type:"search",placeholder:"search: TODO"},null,-1),_t=["disabled"],yt={class:"inline align-top fill-current h-8",viewBox:"0 0 24 24"},xt=["d"],bt=b({props:{pageData:{type:Object,required:!0}},setup(e){const t=e,s=j([]),r=async d=>{d.t===M.IMAGE&&await dt(d.url),s.push(d)},n=C(!1),u=C(0),{addCleanup:m,cleanup:c}=ae();return A(()=>t.pageData.streamURL,Ge(u,async d=>{c();const o=new AbortController;m(()=>o.abort());try{const{body:l}=await fetch(d,{signal:o.signal});if(!l)return;await Se({stream:l,onLine:async f=>{try{await r(Object.freeze(JSON.parse(f)))}catch(_){L.message.error(`line parsing failed: ${_}`)}}})}catch(l){L.message.error(`stream read failed: ${l}`)}L.message.info("stream closed")}),{immediate:!0}),(d,o)=>(p(),h("div",pt,[a("div",ft,[a("label",mt,[(p(),h("svg",ht,[a("path",{d:i(se)},null,8,gt)])),vt]),a("button",{type:"button",class:"bg-white rounded border-gray-300 h-10 px-4 disabled:text-gray-200 disabled:cursor-not-allowed",disabled:u.value===0,onClick:o[0]||(o[0]=l=>n.value=!n.value)},[(p(),h("svg",yt,[a("path",{d:n.value?i(ce):i(de)},null,8,xt)]))],8,_t)]),O(lt,{class:"flex-auto",records:i(s),paused:n.value},null,8,["records","paused"])]))}}),wt={class:"bg-gray-200 text-theme-text min-h-screen"},Ct=b({setup(e){var r;const s=(r=new Map([[G.SINGLE_MODE_ITEM_SELECT,{component:Re}],[G.LOG,{component:bt}]]).get(F.type))!=null?r:{component:ve};return(n,u)=>(p(),h("div",wt,[(p(),I(ne(i(s).component),{"page-data":i(F)},null,8,["page-data"])),O(i(it),{class:"messages z-20"})]))}});pe(Ct).mount("#app");
