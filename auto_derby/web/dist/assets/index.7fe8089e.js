import{d as C,t as b,u,o as i,c as f,a as l,w as P,v as de,r as V,b as _,e as re,f as Q,g as M,m as oe,F,h as R,i as q,j as pe,k as fe,R as me,l as w,n as D,p as le,q as k,s as he,x as ge,y as S,z as ue,A as Y,B as Z,C as ee,D as ce,T as ie,E as j,G as ve,H as ye,I as _e,J as xe}from"./vendor.de0cb7ce.js";const be=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const p of o.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&a(p)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerpolicy&&(o.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?o.credentials="include":n.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}};be();const we=!1,Ce=["\u30B9\u30D4\u30FC\u30C9","\u30B9\u30BF\u30DF\u30CA","\u30D1\u30EF\u30FC","\u6839\u6027","\u8CE2\u3055","\u30E1\u30E2\u5E33","\u6226\u8853\u66F8","\u79D8\u4F1D\u66F8","\u30C8\u30EC\u30FC\u30CB\u30F3\u30B0","\u30E1\u30AC\u30DB\u30F3","\u30BF\u30FC\u30F3","\u30A6\u30A7\u30A4\u30C8","\u8E44\u9244","\u30D0\u30A4\u30BF\u30EB","\u30C9\u30EA\u30F3\u30AF","\u30B1\u30FC\u30AD","\u7D46\u30B2\u30FC\u30B8","\u3084\u308B\u6C17","\u4F53\u529B","\u306B\u306A\u308B","\u89E3\u6D88","\u30EC\u30FC\u30B9","\u30FB","\u306E","\u30FC","\u30E5","\u30C3"];function Ee(...e){}var H=(e=>(e.SINGLE_MODE_ITEM_SELECT="SINGLE_MODE_ITEM_SELECT",e.LOG="LOG",e))(H||{});function $e(){const e=document.getElementById("data");if(!e)throw new Error("'#data' element not found");return JSON.parse(e.innerHTML)}const L=$e(),ke=C({props:{pageData:{type:Object,required:!0}},setup(e){return(t,s)=>b(u(L))}}),De={class:"text-left"},Oe={class:"border-b border-gray-200"},Ae={class:"font-bold"},Fe={class:"text-sm"},Be=l("span",{class:"bg-gray-200 rounded-lg px-1 mr-2"},"\u52B9\u679C",-1),Ie={class:"font-bold"},te=C({props:{value:{type:Object,required:!0},idHidden:{type:Boolean}},setup(e){return(t,s)=>(i(),f("div",De,[l("p",Oe,[l("span",Ae,b(e.value.name),1),P(l("span",{class:"text-sm float-right"},b(e.value.id),513),[[de,!e.idHidden]])]),l("p",Fe,[Be,l("span",Ie,b(e.value.description),1)])]))}}),Me={class:"max-w-lg m-auto space-y-2"},Re={class:"bg-gray-200 sticky top-0 space-y-2"},Le={class:"text-center bg-white p-1 rounded"},Te=l("p",null,"select matching item for this image:",-1),Ne=["src"],qe=["action"],Se=l("span",{class:"bg-gray-200 mx-2 rounded-full px-4"},"id",-1),ze=l("button",{type:"submit",class:"bg-theme-green text-white rounded p-2 font-bold"}," \u78BA\u8A8D ",-1),Ge={class:"space-y-1"},Pe={class:"w-full flex items-center"},je={class:"inline align-top fill-current h-8",viewBox:"0 0 24 24"},He=["d"],Ue={class:"flex gap-1 flex-wrap"},Ve={class:"space-y-2"},We=C({props:{pageData:{type:Object,required:!0}},setup(e){var h;const t=e,s=V({id:(h=t.pageData.defaultValue)!=null?h:0,q:""});function a(r){return[r.name,r.description]}function n(r,c){const m=a(r);return c.split(" ").every(g=>m.some(x=>x.includes(g)))}const o=_(()=>t.pageData.options.filter(r=>n(r,s.q)).map(r=>{const c=r.id===s.id;return{key:r.id,value:r,attrs:{class:["border border-2 cursor-pointer",c?"border-theme-green":"border-gray-200"],onClick:()=>{s.id=r.id}}}})),p=_(()=>Ce.map(r=>{const c=o.value.filter(m=>n(m.value,r)).length;return{key:r,value:r,matchCount:c,attrs:{class:[(()=>c===0?"bg-gray-400 text-white":c===1?"bg-theme-green text-white":"bg-white text-theme-text")()],onClick:()=>{o.value.length!==c&&(s.q=c?`${s.q} ${r}`.trim():r)}}}})),d=_(()=>{var r;return(r=t.pageData.options.find(c=>c.id===s.id))!=null?r:{id:s.id,name:"unknown",description:"unknown"}});return re(()=>{o.value.length===1&&(s.id=o.value[0].value.id)}),(r,c)=>(i(),f("div",Me,[l("div",Re,[l("div",Le,[Te,l("img",{src:u(L).imageURL,class:"sticky m-auto"},null,8,Ne),l("form",{action:u(L).submitURL,method:"POST",class:"flex items-center justify-center gap-2 mx-2"},[l("label",null,[Se,P(l("input",{"onUpdate:modelValue":c[0]||(c[0]=m=>u(s).id=m),type:"number",name:"id",class:"spin-button-none w-16 text-center"},null,512),[[Q,u(s).id,void 0,{number:!0}]])]),M(te,{value:u(d),class:"inline-block border border-gray-200 flex-auto rounded px-2","id-hidden":""},null,8,["value"]),ze],8,qe)]),l("div",Ge,[l("label",Pe,[(i(),f("svg",je,[l("path",{d:u(oe)},null,8,He)])),P(l("input",{"onUpdate:modelValue":c[1]||(c[1]=m=>u(s).q=m),class:"flex-auto",type:"search",placeholder:"search"},null,512),[[Q,u(s).q]])]),l("ol",Ue,[(i(!0),f(F,null,R(u(p),({key:m,value:g,attrs:x})=>(i(),f("li",q({key:m,class:"cursor-pointer inline-block rounded px-1"},x),b(g),17))),128))])])]),l("ul",Ve,[(i(!0),f(F,null,R(u(o),({key:m,attrs:g,value:x})=>(i(),f("li",q({key:m,class:"bg-white rounded p-2"},g),[M(te,{value:x},null,8,["value"])],16))),128))])]))}});function W(){const e=[],t=a=>{e.push(a)},s=()=>{var a;for(;e.length>0;)(a=e.pop())==null||a()};return pe()&&fe(s),{addCleanup:t,cleanup:s}}var z=(e=>(e.TEXT="TEXT",e.IMAGE="IMAGE",e))(z||{}),I=(e=>(e.DEBUG="DEBUG",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR",e))(I||{});async function Ke({stream:e,encoding:t="utf-8",onLine:s}){const a=e.getReader();let n="";const o=new TextDecoder(t);async function p(){const{value:d,done:h}=await a.read();if(h){n&&await s(n);return}const r=o.decode(d);let c=0;for(let m=0;m<r.length;m+=1)r[m]===`
`&&(await s(n+r.slice(c,m)),c=m+1,n="");n+=r.slice(c),await p()}await p()}function Je(e,t){return(...s)=>{e.value+=1;let a=!1;try{const n=t(...s);return n instanceof Promise&&(a=!0,n.finally(()=>{e.value-=1})),n}finally{a||(e.value-=1)}}}function Xe(){return typeof ResizeObserver=="undefined"?me:ResizeObserver}function Qe(e,t){const s=Xe(),a=new s(n=>{n.forEach(o=>{t(o)})});return a.observe(e),()=>a.disconnect()}function se(e){const{addCleanup:t,cleanup:s}=W(),a=w(0),n=w(0);return D(e,o=>{if(s(),!o)return;n.value=o.clientWidth,a.value=o.clientHeight;const p=Qe(o,le(d=>{n.value=d.contentRect.width,a.value=d.contentRect.height},100));t(p)},{immediate:!0}),{width:n,height:a}}const Ye={class:"flex flex-wrap items-start bg-checkerboard p-px relative gap-2"},Ze=["src"],et=["src"],tt={class:"text-white bg-black bg-opacity-50 px-1"},st={key:0,class:"space-x-1"},nt=C({props:{value:{type:Object,required:!0}},setup(e){const t=e,s=_(()=>{var g;return(g=t.value.layers)!=null?g:[]}),a=w(),n=w(),o=w(0),p=_(()=>({name:"main",url:t.value.url})),d=_(()=>{const g=o.value-1,x=s.value;return g in x?x[g]:p.value}),h=_(()=>[p.value,...s.value].map(({name:g},x)=>({key:x,label:g,inputAttrs:{type:"radio",checked:o.value===x,onChange:E=>{E.target.checked&&(o.value=x)}}}))),{width:r}=se(a),{width:c}=se(n),m=_(()=>r.value*3<c.value-20);return(g,x)=>(i(),f("div",{ref_key:"el",ref:n},[l("figure",Ye,[l("img",{ref_key:"img",ref:a,src:u(d).url},null,8,Ze),u(m)?(i(!0),f(F,{key:0},R(u(s),({name:E,url:$},O)=>(i(),f("figure",{key:O},[l("img",{src:$},null,8,et),l("figcaption",tt,b(E),1)]))),128)):k("",!0)]),u(m)?k("",!0):(i(),f(F,{key:0},[u(h).length>1?(i(),f("div",st,[(i(!0),f(F,null,R(u(h),({label:E,inputAttrs:$,key:O})=>(i(),f("label",{key:O},[l("input",he(ge($)),null,16),l("span",null,b(E),1)]))),128))])):k("",!0)],64)),l("figcaption",null,b(e.value.caption),1)],512))}}),at=C({props:{value:{type:Object,required:!0}},setup(e){return(t,s)=>(i(),f("div",null,b(e.value.msg),1))}}),rt=C({props:{value:{type:Object,required:!0}},setup(e){return(t,s)=>(i(),f("div",null,"unsupported item: "+b(e.value),1))}}),ot={class:"p-1 bg-white rounded border border-gray-300"},lt={class:"space-x-1"},ut={class:"text-sm float-right text-gray-400"},ct=l("span",{class:"dot mx-1"},null,-1),it=l("hr",{class:"border-gray-300 my-1"},null,-1),dt=new Map([[z.IMAGE,{component:nt}],[z.TEXT,{component:at}]]),pt={component:rt},ft=C({props:{value:{type:Object,required:!0},lineno:{type:Number,required:!0}},setup(e){const t=e,s=new Intl.DateTimeFormat(void 0,{dateStyle:"short",timeStyle:"medium",hour12:!1}),a=new Intl.DateTimeFormat(void 0,{fractionalSecondDigits:3}),n=_(()=>{const d=new Date(t.value.ts);return`${s.format(d)}.${a.format(d)}`}),o=_(()=>{var d;return(d=dt.get(t.value.t))!=null?d:pt}),p=_(()=>{switch(t.value.lv){case I.DEBUG:return{class:"text-gray-400 bg-gray-800"};case I.INFO:return{class:"bg-gray-300"};case I.WARN:return{class:"bg-orange-500 text-orange-800"};case I.ERROR:return{class:"bg-red-500 text-red-800"};default:return Ee(t.value.lv),{}}});return(d,h)=>(i(),f("li",ot,[l("div",lt,[l("span",q({class:"w-24 inline-block text-center"},u(p)),b(e.value.lv),17),l("span",null,b(e.value.source),1),l("span",ut,[l("span",null,b(u(n)),1),ct,l("span",null,b(e.lineno),1)])]),it,(i(),S(ue(u(o).component),{value:e.value},null,8,["value"]))]))}});function mt(e,t,{deep:s}={}){const a=w(t(e));return D(e,n=>{a.value=w(t(n)).value},{deep:s}),a}function ht(e,...t){const{addCleanup:s,cleanup:a}=W();D(e,n=>{a(),n&&(n.addEventListener(...t),s(()=>{n.removeEventListener(...t)}))},{immediate:!0})}function gt(e,{onScrollToBottom:t,onScrollToTop:s,margin:a=()=>0,marginBottom:n=a,marginTop:o=a}){ht(e,"scroll",p=>{const d=p.target;d.scrollTop+d.clientHeight>=d.scrollHeight-n(d)?t==null||t(d):d.scrollTop<o(d)&&(s==null||s(d))})}function vt(e,t){const s=w(e.value);return D([e,t],([a,n])=>{n||(s.value=w(a).value)}),s}function yt(e,t,s=a=>a){return _({get(){return t(e.value)},set(a){e.value=s(a)}})}function _t(e,t,s){return s<=t?t:Math.min(Math.max(e,t),s)}function xt(e,t,s){return _({get(){return e.value},set:le(a=>{e.value=a},t,s)})}const bt={key:1},wt={key:2,class:"flex flex-center h-full"},Ct=l("div",{class:"text-center"},[l("h1",{class:"text-2xl"},"Log Viewer"),l("p",null,"waiting for record")],-1),Et=[Ct],$t=C({props:{records:{type:Array,required:!0},size:{type:Number,default:100},paused:{type:Boolean}},setup(e){const t=e,s=Y(t,"paused"),a=Y(t,"records"),n=_(()=>{if(!t.paused)return{enterFromClass:"opacity-0 transform translate-x-8",enterActiveClass:"transition-all ease-in-out duration-500 relative",enterToClass:"opacity-100",leaveFromClass:"h-full max-h-fit",leaveToClass:"h-0",leaveActiveClass:"transition-all ease-in-out duration-500 overflow-hidden"}}),o=w(),p=_(()=>{var v;return(v=o.value)==null?void 0:v.$el}),d=xt(w(t.records.length),500,{leading:!0});D(()=>t.records.length,v=>{d.value=v},{deep:!0});const h=vt(d,s),r=yt(w(0),v=>v,v=>_t(v,0,h.value-1)),c=_(()=>r.value>0),m=_(()=>r.value<h.value-t.size),g=v=>{var y;return(y=p.value)==null?void 0:y.querySelector(`li[data-index="${v}"]`)},x=v=>{if(v===0)return;const y=r.value;r.value+=v;const A=r.value;A-y<0&&ee(()=>{const B=g(y),J=g(A),X=p.value;J&&B&&X&&(X.scrollTop-=J.offsetTop-B.offsetTop)})},E=Z(()=>{!c.value||x(-Math.round(t.size/2))},100),$=Z(()=>{!m.value||x(Math.round(t.size/2))},100);gt(p,{onScrollToTop:E,onScrollToBottom:$,margin:v=>Math.min(200,v.offsetHeight*.3)});const O=mt([h,r],()=>t.records.slice(r.value,r.value+t.size).map((v,y)=>({value:v,key:r.value+y,index:r.value+y})));return re(()=>{t.paused||(r.value=Math.max(0,t.records.length-t.size))}),D([()=>t.paused,p,O],([v,y])=>{v||!y||ee(()=>{y.scroll({top:y.scrollHeight,behavior:"smooth"})})},{deep:!0}),(v,y)=>(i(),S(ie,q({ref_key:"el",ref:o,class:"max-h-screen overflow-y-auto overflow-x-hidden space-y-1",tag:"ol"},u(n)),{default:ce(()=>[u(c)?(i(),f("button",{key:0,type:"button",class:"w-full text-blue-500 underline",onClick:y[0]||(y[0]=A=>u(E)())}," load previous records ")):k("",!0),(i(!0),f(F,null,R(u(O),({value:A,key:K,index:B})=>(i(),S(ft,{key:K,value:A,lineno:B+1,"data-index":B},null,8,["value","lineno","data-index"]))),128)),u(m)?(i(),f("span",bt,[l("button",{type:"button",class:"w-full text-blue-500 underline",onClick:y[1]||(y[1]=A=>u($)())}," load next records ")])):k("",!0),u(a).length===0?(i(),f("div",wt,Et)):k("",!0)]),_:1},16))}}),N=V({messages:[]}),kt=C({name:"MessageList",data(){return N},render(){return j(ie,{class:"fixed top-2 w-screen flex flex-col items-center",appear:!0,tag:"ol",enterActiveClass:"transition-all ease-in-out duration-300 absolute",enterFromClass:"transform -translate-y-full -mt-4",leaveActiveClass:"transition-all ease-int-out duration-300 absolute",leaveToClass:"transform -translate-y-full -mt-4"},()=>this.messages.map(e=>{const t=e.render();return t.key=e.key,t}))}});let ne=0;const U=[];let G=!1;const Dt=async()=>{if(!G){G=!0;try{for(;U.length>0;){const[{render:e,onAppear:t}]=U.splice(0,1),s=ne;ne+=1,N.messages.push({key:s,render:e}),await new Promise(a=>{t(()=>{setTimeout(a,500);const o=N.messages.findIndex(p=>p.key===s);o<0||N.messages.splice(o,1)})})}}finally{G=!1}}};function ae(e){return new Promise(t=>{U.push({render:e,onAppear:s=>{t(s)}}),Dt()})}class Ot{async info(t,s=1e3+t.length*200){const a=await ae(()=>j("li",{class:["p-2 rounded max-w-md w-full shadow min-h-12","border-2 border-theme-toast","flex flex-center","bg-gray-50 text-theme-text break-all font-bold"]},t));setTimeout(a,s)}async error(t,s=1e3+t.length*200){const a=await ae(()=>j("li",{class:["p-2 rounded max-w-md w-full shadow min-h-12","border-2 border-red-400","flex flex-center","bg-red-50 text-theme-text break-all font-bold"]},t));setTimeout(a,s)}}const T={message:new Ot};async function At(e){const t=new Image;return t.src=e,t.alt=e,await t.decode(),t}const Ft={class:"container max-w-2xl m-auto h-screen overflow-hidden flex flex-col gap-1"},Bt={class:"flex-none flex gap-1"},It={class:"flex flex-auto items-center"},Mt={class:"inline align-top fill-current h-8",viewBox:"0 0 24 24"},Rt=["d"],Lt=l("input",{class:"flex-auto rounded border-gray-300",type:"search",placeholder:"TODO: search"},null,-1),Tt=["disabled"],Nt={class:"inline align-top fill-current h-8",viewBox:"0 0 24 24"},qt=["d"],St=C({props:{pageData:{type:Object,required:!0}},setup(e){const t=e,s=V([]),a=async h=>{if(h.t===z.IMAGE)try{await At(h.url)}catch(r){T.message.error(`load image failed: ${h.url}: ${r}`)}s.push(h)},n=w(!1),o=w(0),{addCleanup:p,cleanup:d}=W();return D(()=>t.pageData.streamURL,Je(o,async h=>{d();const r=new AbortController;p(()=>r.abort());try{const{body:c}=await fetch(h,{signal:r.signal});if(!c)return;await Ke({stream:c,onLine:async m=>{try{await a(Object.freeze(JSON.parse(m)))}catch(g){T.message.error(`line parsing failed: ${g}`)}}})}catch(c){T.message.error(`stream read failed: ${c}`)}T.message.info("stream closed")}),{immediate:!0}),(h,r)=>(i(),f("div",Ft,[M($t,{class:"flex-auto",records:u(s),paused:n.value},null,8,["records","paused"]),l("div",Bt,[l("label",It,[(i(),f("svg",Mt,[l("path",{d:u(oe)},null,8,Rt)])),Lt]),M(ve,{"leave-from-class":"","leave-active-class":"transition duration-300 ease-in-out","leave-to-class":"opacity-0 transform translate-x-full"},{default:ce(()=>[o.value>0?(i(),f("button",{key:0,type:"button",class:"bg-white flex-initial rounded border-gray-300 h-10 px-4 disabled:text-gray-200 disabled:cursor-not-allowed",disabled:o.value===0,onClick:r[0]||(r[0]=c=>n.value=!n.value)},[(i(),f("svg",Nt,[l("path",{d:n.value?u(ye):u(_e)},null,8,qt)]))],8,Tt)):k("",!0)]),_:1})])]))}}),zt={class:"bg-gray-200 text-theme-text min-h-screen"},Gt=C({setup(e){var a;const s=(a=new Map([[H.SINGLE_MODE_ITEM_SELECT,{component:We}],[H.LOG,{component:St}]]).get(L.type))!=null?a:{component:ke};return(n,o)=>(i(),f("div",zt,[(i(),S(ue(u(s).component),{"page-data":u(L)},null,8,["page-data"])),M(u(kt),{class:"messages z-20"})]))}});xe(Gt).mount("#app");
