import{d as x,t as y,u as l,o as p,c as h,a,w as L,v as oe,r as j,b as _,e as te,f as K,g as O,m as se,F as N,h as q,i as k,j as ue,k as le,l as I,n as ne,p as C,q as B,s as W,x as X,y as ie,T as re,z as J,A as M,B as S,C as ce,D as de,E as pe}from"./vendor.e09f1a32.js";const fe=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const u of r)if(u.type==="childList")for(const m of u.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&n(m)}).observe(document,{childList:!0,subtree:!0});function s(r){const u={};return r.integrity&&(u.integrity=r.integrity),r.referrerpolicy&&(u.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?u.credentials="include":r.crossorigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function n(r){if(r.ep)return;r.ep=!0;const u=s(r);fetch(r.href,u)}};fe();const me=["\u30B9\u30D4\u30FC\u30C9","\u30B9\u30BF\u30DF\u30CA","\u30D1\u30EF\u30FC","\u6839\u6027","\u8CE2\u3055","\u30E1\u30E2\u5E33","\u6226\u8853\u66F8","\u79D8\u4F1D\u66F8","\u30C8\u30EC\u30FC\u30CB\u30F3\u30B0","\u30E1\u30AC\u30DB\u30F3","\u30BF\u30FC\u30F3","\u30A6\u30A7\u30A4\u30C8","\u8E44\u9244","\u30D0\u30A4\u30BF\u30EB","\u30C9\u30EA\u30F3\u30AF","\u30B1\u30FC\u30AD","\u7D46\u30B2\u30FC\u30B8","\u3084\u308B\u6C17","\u4F53\u529B","\u306B\u306A\u308B","\u89E3\u6D88","\u30EC\u30FC\u30B9","\u30FB","\u306E","\u30FC","\u30E5","\u30C3"];function he(...e){}var R=(e=>(e.SINGLE_MODE_ITEM_SELECT="SINGLE_MODE_ITEM_SELECT",e.LOG="LOG",e))(R||{});function ge(){const e=document.getElementById("data");if(!e)throw new Error("'#data' element not found");return JSON.parse(e.innerHTML)}const F=ge(),ve=x({props:{pageData:{type:Object,required:!0}},setup(e){return(t,s)=>y(l(F))}}),_e={class:"text-left"},ye={class:"border-b border-gray-200"},xe={class:"font-bold"},be={class:"text-sm"},we=a("span",{class:"bg-gray-200 rounded-lg px-1 mr-2"},"\u52B9\u679C",-1),Ce={class:"font-bold"},Q=x({props:{value:{type:Object,required:!0},idHidden:{type:Boolean}},setup(e){return(t,s)=>(p(),h("div",_e,[a("p",ye,[a("span",xe,y(e.value.name),1),L(a("span",{class:"text-sm float-right"},y(e.value.id),513),[[oe,!e.idHidden]])]),a("p",be,[we,a("span",Ce,y(e.value.description),1)])]))}}),Ee={class:"max-w-lg m-auto space-y-2"},$e={class:"bg-gray-200 sticky top-0 space-y-2"},De={class:"text-center bg-white p-1 rounded"},Fe=a("p",null,"select matching item for this image:",-1),Be=["src"],Ae=["action"],Oe=a("span",{class:"bg-gray-200 mx-2 rounded-full px-4"},"id",-1),ke=a("button",{type:"submit",class:"bg-theme-green text-white rounded p-2 font-bold"}," \u78BA\u8A8D ",-1),Ie={class:"space-y-1"},Me={class:"w-full flex items-center"},Te={class:"inline align-top fill-current h-8",viewBox:"0 0 24 24"},Le=["d"],Ne={class:"flex gap-1 flex-wrap"},qe={class:"space-y-2"},Se=x({props:{pageData:{type:Object,required:!0}},setup(e){var d;const t=e,s=j({id:(d=t.pageData.defaultValue)!=null?d:0,q:""});function n(o){return[o.name,o.description]}function r(o,c){const f=n(o);return c.split(" ").every(b=>f.some(w=>w.includes(b)))}const u=_(()=>t.pageData.options.filter(o=>r(o,s.q)).map(o=>{const c=o.id===s.id;return{key:o.id,value:o,attrs:{class:["border border-2 cursor-pointer",c?"border-theme-green":"border-gray-200"],onClick:()=>{s.id=o.id}}}})),m=_(()=>me.map(o=>{const c=u.value.filter(f=>r(f.value,o)).length;return{key:o,value:o,matchCount:c,attrs:{class:[(()=>c===0?"bg-gray-400 text-white":c===1?"bg-theme-green text-white":"bg-white text-theme-text")()],onClick:()=>{u.value.length!==c&&(s.q=c?`${s.q} ${o}`.trim():o)}}}})),i=_(()=>{var o;return(o=t.pageData.options.find(c=>c.id===s.id))!=null?o:{id:s.id,name:"unknown",description:"unknown"}});return te(()=>{u.value.length===1&&(s.id=u.value[0].value.id)}),(o,c)=>(p(),h("div",Ee,[a("div",$e,[a("div",De,[Fe,a("img",{src:l(F).imageURL,class:"sticky m-auto"},null,8,Be),a("form",{action:l(F).submitURL,method:"POST",class:"flex items-center justify-center gap-2 mx-2"},[a("label",null,[Oe,L(a("input",{"onUpdate:modelValue":c[0]||(c[0]=f=>l(s).id=f),type:"number",name:"id",class:"spin-button-none w-16 text-center"},null,512),[[K,l(s).id,void 0,{number:!0}]])]),O(Q,{value:l(i),class:"inline-block border border-gray-200 flex-auto rounded px-2","id-hidden":""},null,8,["value"]),ke],8,Ae)]),a("div",Ie,[a("label",Me,[(p(),h("svg",Te,[a("path",{d:l(se)},null,8,Le)])),L(a("input",{"onUpdate:modelValue":c[1]||(c[1]=f=>l(s).q=f),class:"flex-auto",type:"search",placeholder:"search"},null,512),[[K,l(s).q]])]),a("ol",Ne,[(p(!0),h(N,null,q(l(m),({key:f,value:b,attrs:w})=>(p(),h("li",k({key:f,class:"cursor-pointer inline-block rounded px-1"},w),y(b),17))),128))])])]),a("ul",qe,[(p(!0),h(N,null,q(l(u),({key:f,attrs:b,value:w})=>(p(),h("li",k({key:f,class:"bg-white rounded p-2"},b),[O(Q,{value:w},null,8,["value"])],16))),128))])]))}});function ae(){const e=[],t=n=>{e.push(n)},s=()=>{var n;for(;e.length>0;)(n=e.pop())==null||n()};return ue()&&le(s),{addCleanup:t,cleanup:s}}async function Re({stream:e,encoding:t="utf-8",onLine:s}){const n=e.getReader();let r="";const u=new TextDecoder(t);async function m(){const{value:i,done:d}=await n.read();if(d){r&&await s(r);return}const o=u.decode(i);let c=0;for(let f=0;f<o.length;f+=1)o[f]===`
`&&(await s(r+o.slice(c,f)),c=f+1,r="");r+=o.slice(c),await m()}await m()}function Ge(e,t){return(...s)=>{e.value+=1;let n=!1;try{const r=t(...s);return r instanceof Promise&&(n=!0,r.finally(()=>{e.value-=1})),r}finally{n||(e.value-=1)}}}var G=(e=>(e.TEXT="TEXT",e.IMAGE="IMAGE",e))(G||{}),D=(e=>(e.DEBUG="DEBUG",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR",e))(D||{});const je=["src"],ze=x({props:{value:{type:Object,required:!0}},setup(e){return(t,s)=>(p(),h("figure",null,[a("img",{src:e.value.url},null,8,je),a("figcaption",null,y(e.value.caption),1)]))}}),Pe=x({props:{value:{type:Object,required:!0}},setup(e){return(t,s)=>(p(),h("div",null,y(e.value.msg),1))}}),Ue=x({props:{value:{type:Object,required:!0}},setup(e){return(t,s)=>(p(),h("div",null,"unsupported item: "+y(e.value),1))}}),Ve={class:"p-1 bg-white rounded border border-gray-300"},He={class:""},Ke={class:"text-sm float-right text-gray-400"},We=a("span",{class:"dot mx-1"},null,-1),Xe=a("hr",{class:"border-gray-300 my-1"},null,-1),Je=new Map([[G.IMAGE,{component:ze}],[G.TEXT,{component:Pe}]]),Qe={component:Ue},Ye=x({props:{value:{type:Object,required:!0},lineno:{type:Number,required:!0}},setup(e){const t=e,s=new Intl.DateTimeFormat(void 0,{dateStyle:"short",timeStyle:"medium",hour12:!1}),n=new Intl.DateTimeFormat(void 0,{fractionalSecondDigits:3}),r=_(()=>{const i=new Date(t.value.ts);return`${s.format(i)}.${n.format(i)}`}),u=_(()=>{var i;return(i=Je.get(t.value.t))!=null?i:Qe}),m=_(()=>{switch(t.value.lv){case D.DEBUG:return{class:"text-gray-400 bg-gray-800"};case D.INFO:return{class:"bg-gray-300"};case D.WARN:return{class:"bg-orange-500 text-orange-800"};case D.ERROR:return{class:"bg-red-500 text-red-800"};default:return he(t.value.lv),{}}});return(i,d)=>(p(),h("li",Ve,[a("div",He,[a("span",k({class:"w-24 inline-block text-center"},l(m)),y(e.value.lv),17),a("span",Ke,[a("span",null,y(l(r)),1),We,a("span",null,y(e.lineno),1)])]),Xe,(p(),I(ne(l(u).component),{value:e.value},null,8,["value"]))]))}});function Y(e,t,{deep:s}={}){const n=C(t(e));return B(e,r=>{n.value=C(t(r)).value},{deep:s}),n}function Ze(e,...t){const{addCleanup:s,cleanup:n}=ae();B(e,r=>{n(),r&&(r.addEventListener(...t),s(()=>{r.removeEventListener(...t)}))},{immediate:!0})}function et(e,{onScrollToBottom:t,onScrollToTop:s,margin:n=()=>0,marginBottom:r=n,marginTop:u=n}){Ze(e,"scroll",m=>{const i=m.target;i.scrollTop+i.clientHeight>=i.scrollHeight-r(i)?t==null||t(i):i.scrollTop<u(i)&&(s==null||s(i))})}function tt(e,t){const s=C(e.value);return B([e,t],([n,r])=>{r||(s.value=C(n).value)}),s}function st(e,t,s=n=>n){return _({get(){return t(e.value)},set(n){e.value=s(n)}})}function nt(e,t,s){return s<=t?t:Math.min(Math.max(e,t),s)}const rt={key:1},at={key:2,class:"flex flex-center h-full"},ot=a("div",{class:"text-center"},[a("h1",{class:"text-2xl"},"Log Viewer"),a("p",null,"no record")],-1),ut=[ot],lt=x({props:{records:{type:Array,required:!0},size:{type:Number,default:100},paused:{type:Boolean}},setup(e){const t=e,s=W(t,"paused"),n=W(t,"records"),r=_(()=>{if(!t.paused)return{enterFromClass:"opacity-0 transform translate-x-8",enterActiveClass:"transition-all ease-in-out duration-500 relative",enterToClass:"opacity-100",leaveFromClass:"h-full max-h-fit",leaveToClass:"h-0",leaveActiveClass:"transition-all ease-in-out duration-500 overflow-hidden"}}),u=C(),m=_(()=>{var g;return(g=u.value)==null?void 0:g.$el}),i=tt(Y(()=>t.records,()=>t.records.length,{deep:!0}),s),d=st(C(0),g=>g,g=>nt(g,0,i.value-1)),o=_(()=>d.value>0),c=_(()=>d.value<i.value-t.size),f=g=>{var v;return(v=m.value)==null?void 0:v.querySelector(`li[data-index="${g}"]`)},b=g=>{if(g===0)return;const v=d.value;d.value+=g;const E=d.value;E-v<0&&J(()=>{const $=f(v),V=f(E),H=m.value;V&&$&&H&&(H.scrollTop-=V.offsetTop-$.offsetTop)})},w=X(()=>{!o.value||b(-Math.round(t.size/2))},100),z=X(()=>{!c.value||b(Math.round(t.size/2))},100);et(m,{onScrollToTop:w,onScrollToBottom:z,margin:g=>g.offsetHeight*.3});const P=Y([i,d],()=>t.records.slice(d.value,d.value+t.size).map((g,v)=>({value:g,key:d.value+v,index:d.value+v})));return te(()=>{t.paused||(d.value=Math.max(0,t.records.length-t.size))}),B([()=>t.paused,m,P],([g,v])=>{g||!v||J(()=>{v.scroll({top:v.scrollHeight,behavior:"smooth"})})},{deep:!0}),(g,v)=>(p(),I(re,k({ref_key:"el",ref:u,class:"max-h-screen overflow-y-auto overflow-x-hidden space-y-1",tag:"ol"},l(r)),{default:ie(()=>[l(o)?(p(),h("button",{key:0,type:"button",class:"w-full text-blue-500 underline",onClick:v[0]||(v[0]=E=>l(w)())}," load previous records ")):M("",!0),(p(!0),h(N,null,q(l(P),({value:E,key:U,index:$})=>(p(),I(Ye,{key:U,value:E,lineno:$+1,"data-index":$},null,8,["value","lineno","data-index"]))),128)),l(c)?(p(),h("span",rt,[a("button",{type:"button",class:"w-full text-blue-500 underline",onClick:v[1]||(v[1]=E=>l(z)())}," load next records ")])):M("",!0),l(n).length===0?(p(),h("div",at,ut)):M("",!0)]),_:1},16))}}),A=j({messages:[]}),it=x({name:"MessageList",data(){return A},render(){return S(re,{class:"fixed top-0 right-4 flex flex-col-reverse items-end",appear:!0,tag:"ol",moveClass:"transition ease-in-out duration-200",enterActiveClass:"transition ease-in-out duration-300",enterFromClass:"opacity-0 transform translate-x-full",leaveActiveClass:"transition ease-in-out duration-1000",leaveToClass:"opacity-0"},()=>this.messages.map(e=>{const t=e.render();return t.key=e.key,t}))}});let Z=0;function ee(e){const t=Z;return Z+=1,A.messages.splice(0,0,{key:t,render:e}),()=>{const s=A.messages.findIndex(n=>n.key===t);s<0||A.messages.splice(s,1)}}class ct{info(t,s=3e3+200*t.length){const n=ee(()=>S("li",{class:"p-3 rounded-sm w-64 mx-2 my-1 bg-gray-900 text-white break-all"},t));setTimeout(n,s)}error(t,s=3e3+200*t.length){const n=ee(()=>S("li",{class:"p-3 rounded-sm w-64 mx-2 my-1 bg-red-700 text-white break-all"},t));setTimeout(n,s)}}const T={message:new ct},dt={class:"container max-w-2xl m-auto h-screen overflow-hidden flex flex-col gap-1"},pt={class:"flex-none flex gap-1"},ft={class:"flex flex-auto items-center"},mt={class:"inline align-top fill-current h-8",viewBox:"0 0 24 24"},ht=["d"],gt=a("input",{class:"flex-auto rounded border-gray-300",type:"search",placeholder:"search: TODO"},null,-1),vt=["disabled"],_t={class:"inline align-top fill-current h-8",viewBox:"0 0 24 24"},yt=["d"],xt=x({props:{pageData:{type:Object,required:!0}},setup(e){const t=e,s=j([]),n=C(!1),r=C(0),{addCleanup:u,cleanup:m}=ae();return B(()=>t.pageData.streamURL,Ge(r,async i=>{m();const d=new AbortController;u(()=>d.abort());try{const{body:o}=await fetch(i,{signal:d.signal});if(!o)return;await Re({stream:o,onLine:c=>{try{s.push(Object.freeze(JSON.parse(c)))}catch(f){T.message.error(`line parsing failed: ${f}`)}}})}catch(o){T.message.error(`stream read failed: ${o}`)}T.message.info("stream closed")}),{immediate:!0}),(i,d)=>(p(),h("div",dt,[a("div",pt,[a("label",ft,[(p(),h("svg",mt,[a("path",{d:l(se)},null,8,ht)])),gt]),a("button",{type:"button",class:"bg-white rounded border-gray-300 h-10 px-4 disabled:text-gray-200 disabled:cursor-not-allowed",disabled:r.value===0,onClick:d[0]||(d[0]=o=>n.value=!n.value)},[(p(),h("svg",_t,[a("path",{d:n.value?l(ce):l(de)},null,8,yt)]))],8,vt)]),O(lt,{class:"flex-auto",records:l(s),paused:n.value},null,8,["records","paused"])]))}}),bt={class:"bg-gray-200 text-theme-text min-h-screen"},wt=x({setup(e){var n;const s=(n=new Map([[R.SINGLE_MODE_ITEM_SELECT,{component:Se}],[R.LOG,{component:xt}]]).get(F.type))!=null?n:{component:ve};return(r,u)=>(p(),h("div",bt,[(p(),I(ne(l(s).component),{"page-data":l(F)},null,8,["page-data"])),O(l(it),{class:"messages z-20"})]))}});pe(wt).mount("#app");
