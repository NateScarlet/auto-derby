import{d as g,t as h,u as d,o as l,c as p,a as o,w as E,v as V,r as O,b as x,e as R,f as S,g as C,m as U,F as B,h as D,i as T,j as H,k as K,l as M,n as G,p as z,q as $,s as F,x as k,T as X,y as J,z as Q,A as W,B as Y}from"./vendor.d788b750.js";const Z=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const m of c.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&r(m)}).observe(document,{childList:!0,subtree:!0});function t(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerpolicy&&(c.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?c.credentials="include":s.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(s){if(s.ep)return;s.ep=!0;const c=t(s);fetch(s.href,c)}};Z();const ee=["\u30B9\u30D4\u30FC\u30C9","\u30B9\u30BF\u30DF\u30CA","\u30D1\u30EF\u30FC","\u6839\u6027","\u8CE2\u3055","\u30E1\u30E2\u5E33","\u6226\u8853\u66F8","\u79D8\u4F1D\u66F8","\u30C8\u30EC\u30FC\u30CB\u30F3\u30B0","\u30E1\u30AC\u30DB\u30F3","\u30BF\u30FC\u30F3","\u30A6\u30A7\u30A4\u30C8","\u8E44\u9244","\u30D0\u30A4\u30BF\u30EB","\u30C9\u30EA\u30F3\u30AF","\u30B1\u30FC\u30AD","\u7D46\u30B2\u30FC\u30B8","\u3084\u308B\u6C17","\u4F53\u529B","\u306B\u306A\u308B","\u89E3\u6D88","\u30EC\u30FC\u30B9","\u30FB","\u306E","\u30FC","\u30E5","\u30C3"];var A=(e=>(e.SINGLE_MODE_ITEM_SELECT="SINGLE_MODE_ITEM_SELECT",e.LOG="LOG",e))(A||{});function te(){const e=document.getElementById("data");if(!e)throw new Error("'#data' element not found");return JSON.parse(e.innerHTML)}const b=te(),se=g({props:{pageData:{type:Object,required:!0}},setup(e){return(n,t)=>h(d(b))}}),ne={class:"text-left"},re={class:"border-b border-gray-200"},ae={class:"font-bold"},oe={class:"text-sm"},ue=o("span",{class:"bg-gray-200 rounded-lg px-1 mr-2"},"\u52B9\u679C",-1),ce={class:"font-bold"},q=g({props:{value:{type:Object,required:!0},idHidden:{type:Boolean}},setup(e){return(n,t)=>(l(),p("div",ne,[o("p",re,[o("span",ae,h(e.value.name),1),E(o("span",{class:"text-sm float-right"},h(e.value.id),513),[[V,!e.idHidden]])]),o("p",oe,[ue,o("span",ce,h(e.value.description),1)])]))}}),ie={class:"max-w-lg m-auto space-y-2"},le={class:"bg-gray-200 sticky top-0 space-y-2"},de={class:"text-center bg-white p-1 rounded"},pe=o("p",null,"select matching item for this image:",-1),me=["src"],fe=["action"],ge=o("span",{class:"bg-gray-200 mx-2 rounded-full px-4"},"id",-1),he=o("button",{type:"submit",class:"bg-theme-green text-white rounded p-2 font-bold"}," \u78BA\u8A8D ",-1),_e={class:"space-y-1"},ve={class:"w-full flex items-center"},ye={class:"inline align-top fill-current h-8",viewBox:"0 0 24 24"},be=["d"],xe={class:"flex gap-1 flex-wrap"},we={class:"space-y-2"},Ce=g({props:{pageData:{type:Object,required:!0}},setup(e){var y;const n=e,t=O({id:(y=n.pageData.defaultValue)!=null?y:0,q:""});function r(a){return[a.name,a.description]}function s(a,u){const i=r(a);return u.split(" ").every(f=>i.some(v=>v.includes(f)))}const c=x(()=>n.pageData.options.filter(a=>s(a,t.q)).map(a=>{const u=a.id===t.id;return{key:a.id,value:a,attrs:{class:["border border-2 cursor-pointer",u?"border-theme-green":"border-gray-200"],onClick:()=>{t.id=a.id}}}})),m=x(()=>ee.map(a=>{const u=c.value.filter(i=>s(i.value,a)).length;return{key:a,value:a,matchCount:u,attrs:{class:[(()=>u===0?"bg-gray-400 text-white":u===1?"bg-theme-green text-white":"bg-white text-theme-text")()],onClick:()=>{c.value.length!==u&&(t.q=u?`${t.q} ${a}`.trim():a)}}}})),_=x(()=>{var a;return(a=n.pageData.options.find(u=>u.id===t.id))!=null?a:{id:t.id,name:"unknown",description:"unknown"}});return R(()=>{c.value.length===1&&(t.id=c.value[0].value.id)}),(a,u)=>(l(),p("div",ie,[o("div",le,[o("div",de,[pe,o("img",{src:d(b).imageURL,class:"sticky m-auto"},null,8,me),o("form",{action:d(b).submitURL,method:"POST",class:"flex items-center justify-center gap-2 mx-2"},[o("label",null,[ge,E(o("input",{"onUpdate:modelValue":u[0]||(u[0]=i=>d(t).id=i),type:"number",name:"id",class:"spin-button-none w-16 text-center"},null,512),[[S,d(t).id,void 0,{number:!0}]])]),C(q,{value:d(_),class:"inline-block border border-gray-200 flex-auto rounded px-2","id-hidden":""},null,8,["value"]),he],8,fe)]),o("div",_e,[o("label",ve,[(l(),p("svg",ye,[o("path",{d:d(U)},null,8,be)])),E(o("input",{"onUpdate:modelValue":u[1]||(u[1]=i=>d(t).q=i),class:"flex-auto",type:"search",placeholder:"search"},null,512),[[S,d(t).q]])]),o("ol",xe,[(l(!0),p(B,null,D(d(m),({key:i,value:f,attrs:v})=>(l(),p("li",T({key:i,class:"cursor-pointer inline-block rounded px-1"},v),h(f),17))),128))])])]),o("ul",we,[(l(!0),p(B,null,D(d(c),({key:i,attrs:f,value:v})=>(l(),p("li",T({key:i,class:"bg-white rounded p-2"},f),[C(q,{value:v},null,8,["value"])],16))),128))])]))}});function Ee(){const e=[],n=r=>{e.push(r)},t=()=>{var r;for(;e.length>0;)(r=e.pop())==null||r()};return H()&&K(t),{addCleanup:n,cleanup:t}}async function Be({stream:e,encoding:n="utf-8",onLine:t}){const r=e.getReader();let s="";const c=new TextDecoder(n);async function m(){const{value:_,done:y}=await r.read();if(y){s&&await t(s);return}const a=c.decode(_);let u=0;for(let i=0;i<a.length;i+=1)a[i]===`
`&&(await t(s+a.slice(u,i)),u=i+1,s="");s+=a.slice(u),await m()}await m()}function De(e,n){return(...t)=>{e.value+=1;let r=!1;try{const s=n(...t);return s instanceof Promise&&(r=!0,s.finally(()=>{e.value-=1})),s}finally{r||(e.value-=1)}}}var L=(e=>(e.TEXT="TEXT",e.IMAGE="IMAGE",e))(L||{});const $e=["src"],Fe=g({props:{value:{type:Object,required:!0}},setup(e){return(n,t)=>(l(),p("figure",null,[o("img",{src:e.value.url},null,8,$e),o("figcaption",null,h(e.value.caption),1)]))}}),ke=g({props:{value:{type:Object,required:!0}},setup(e){return(n,t)=>(l(),p("div",null,h(e.value.msg),1))}}),Ae=g({props:{value:{type:Object,required:!0}},setup(e){return(n,t)=>(l(),p("div",null,"unsupported item type: "+h(e.value.t),1))}}),Le={class:"group"},Oe={class:"invisible group-hover:visible"},Me=new Map([[L.IMAGE,{component:Fe}],[L.TEXT,{component:ke}]]),Se={component:Ae},Te=g({props:{value:{type:Object,required:!0},lineno:{type:Number,required:!0}},setup(e){const n=e,t=x(()=>{var r;return(r=Me.get(n.value.t))!=null?r:Se});return(r,s)=>(l(),p("li",Le,[o("span",null,h(e.lineno),1),o("span",Oe,h(e.value.ts),1),(l(),M(G(d(t).component),{value:e.value},null,8,["value"]))]))}}),qe=g({props:{records:{type:Array,required:!0}},setup(e){const t=z(e,"records"),r=$();return F([r,t],([s])=>{!s||s.scroll({top:s.scrollHeight})},{deep:!0}),(s,c)=>(l(),p("ol",{ref_key:"el",ref:r,class:"max-h-screen p-4 overflow-auto space-y-2"},[(l(!0),p(B,null,D(d(t),(m,_)=>(l(),M(Te,{key:_,class:"bg-white rounded",value:m,lineno:_+1},null,8,["value","lineno"]))),128))],512))}}),w=O({messages:[]}),Ie=g({name:"MessageList",data(){return w},render(){return k(X,{class:"fixed top-0 right-4 flex flex-col-reverse items-end",appear:!0,tag:"ol",moveClass:"transition ease-in-out duration-200",enterActiveClass:"transition ease-in-out duration-300",enterFromClass:"opacity-0 transform translate-x-full",leaveActiveClass:"transition ease-in-out duration-1000",leaveToClass:"opacity-0"},()=>this.messages.map(e=>{const n=e.render();return n.key=e.key,n}))}});let I=0;function N(e){const n=I;return I+=1,w.messages.splice(0,0,{key:n,render:e}),()=>{const t=w.messages.findIndex(r=>r.key===n);t<0||w.messages.splice(t,1)}}class Ne{info(n,t=3e3+200*n.length){const r=N(()=>k("li",{class:"p-3 rounded-sm w-64 mx-2 my-1 bg-gray-900 text-white break-all"},n));setTimeout(r,t)}error(n,t=3e3+200*n.length){const r=N(()=>k("li",{class:"p-3 rounded-sm w-64 mx-2 my-1 bg-red-700 text-white break-all"},n));setTimeout(r,t)}}const j={message:new Ne},je={class:"container m-auto"},Ge={class:"p-1"},Pe={class:"inline align-top fill-current h-8",viewBox:"0 0 24 24"},Ve=["d"],Re={key:0,class:"text-center"},Ue=g({props:{pageData:{type:Object,required:!0}},setup(e){const n=e,t=O([]),r=[],s=$(!1),c=()=>{s.value||(t.push(...r),r.length=0)},m=u=>{r.push(u),c()};F(s,u=>{u||c()});const _=$(0),{addCleanup:y,cleanup:a}=Ee();return F(()=>n.pageData.streamURL,De(_,async u=>{a();const i=new AbortController;y(()=>i.abort());try{const{body:f}=await fetch(u,{signal:i.signal});if(!f)return;await Be({stream:f,onLine:v=>{try{m(Object.freeze(JSON.parse(v)))}catch(P){j.message.error(`line parsing failed: ${P}`)}}})}catch(f){j.message.error(`stream read failed: ${f}`)}}),{immediate:!0}),(u,i)=>(l(),p("div",je,[o("div",Ge,[o("button",{type:"button",class:"bg-white rounded px-4",onClick:i[0]||(i[0]=f=>s.value=!s.value)},[(l(),p("svg",Pe,[o("path",{d:s.value?d(J):d(Q)},null,8,Ve)]))])]),C(qe,{records:d(t)},null,8,["records"]),_.value===0?(l(),p("div",Re,"log end")):W("",!0)]))}}),He={class:"bg-gray-200 text-theme-text min-h-screen"},Ke=g({setup(e){var r;const t=(r=new Map([[A.SINGLE_MODE_ITEM_SELECT,{component:Ce}],[A.LOG,{component:Ue}]]).get(b.type))!=null?r:{component:se};return(s,c)=>(l(),p("div",He,[(l(),M(G(d(t).component),{"page-data":d(b)},null,8,["page-data"])),C(d(Ie),{class:"messages z-20"})]))}});Y(Ke).mount("#app");
